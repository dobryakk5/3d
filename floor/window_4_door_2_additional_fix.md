# Дополнительное исправление для window_4 и door_2

## Описание проблемы

Хотя система правильно определила, что window_4 и door_2 находятся рядом, есть еще одна проблема:
1. От window_4 в направлении right стена не создается (правильно)
2. От door_2 в направлении left создается маленькая стена (неправильно)

Проблема в том, что мы проверяем наличие соседних проемов после сдвига края проема, но не учитываем, что после сдвига проемы могут стать смежными.

## Анализ текущей ситуации

Из вывода скрипта:
```
Вызов construct_wall_segment_from_opening для проема window_4
  DEBUG: Обработка проема window_4, ориентация: horizontal
  DEBUG: Проверка проема window_4 в направлении left, найден соседний проем: None
  Соседний проем не найден, создаем стену
  DEBUG: Проверка проема window_4 в направлении right, найден соседний проем: door_2
  Найден соседний проем door_2, стена не создается

Вызов construct_wall_segment_from_opening для проема door_2
  DEBUG: Обработка проема door_2, ориентация: horizontal
  Сдвигаем край проема door_2 до junction 17 в направлении left
  Проем door_2 изменен: {'x': 720.0, 'y': 139.0, 'width': 87.0, 'height': 22.0} -> {'x': 718.0, 'y': 139.0, 'width': 89.0, 'height': 22.0}
  DEBUG: Проверка проема door_2 в направлении left, найден соседний проем: None
  Соседний проем не найден, создаем стену
```

Проблема в том, что:
1. window_4 проверяет наличие соседних проемов и находит door_2, поэтому стена не создается
2. door_2 сдвигает свой край до junction 17, но затем проверяет наличие соседних проемов и не находит window_4 (потому что bbox window_4 не был обновлен)

## Решение

Нужно обновить логику так, чтобы:
1. После сдвига края проема до junction, система должна проверить, есть ли теперь соседний проем, учитывая новое положение края
2. Если соседний проем найден, стена не создается

## Изменения в функции construct_wall_segment_from_opening

В функции `construct_wall_segment_from_opening` после сдвига края проема нужно добавить проверку наличия соседних проемов с учетом нового положения:

```python
# После сдвига края проема до junction
if junction_near_edge:
    # Сдвигаем край проема до junction
    print(f"    Сдвигаем край проема {opening_id} до junction {nearest_junction.id} в направлении {direction}")
    # Изменяем bbox проема, чтобы его край доходил до junction
    adjusted_bbox = extend_opening_to_junction(
        {'id': opening_id, 'bbox': bbox},
        direction,
        nearest_junction
    )
    # Обновляем bbox проема
    opening_with_junction.bbox = adjusted_bbox
    print(f"    Проем {opening_id} изменен: {bbox} -> {adjusted_bbox}")
    bbox = adjusted_bbox  # Обновляем локальную переменную для дальнейших проверок
    
    # ДОБАВЛЕНО: После сдвига края проема, проверяем наличие соседних проемов еще раз
    temp_opening = {
        'id': opening_id,
        'bbox': bbox
    }
    nearby_opening_after_shift = find_nearby_opening_in_direction(temp_opening, direction, all_openings, wall_thickness)
    if nearby_opening_after_shift:
        print(f"    После сдвига края найден соседний проем {nearby_opening_after_shift.get('id')}, стена не создается")
        continue  # Не создаем стену, если есть соседний проем
```

## Ожидаемый результат

После этих изменений:
1. window_4 не создаст стену в направлении right (как и раньше)
2. door_2 после сдвига края до junction 17 обнаружит window_4 и не создаст стену в направлении left
3. Между проемами не будет лишней стены