============================================================
ТЕСТИРОВАНИЕ РАСШИРЕНИЯ L-JUNCTIONS
============================================================
Загрузка данных из: plan_floor1_objects.json
  ✓ Данные успешно загружены
  ✓ Толщина стен определена по минимальной толщине дверей: 22.0 px
✓ Толщина стен: 22.0 px
  ✓ Загружено 45 junctions
Обработка 13 проемов:
  ✓ Проем window_2 (horizontal): 2 сегментов
  ✓ Проем window_4 (horizontal): 2 сегментов
  ✓ Проем door_2 (horizontal): 2 сегментов
  ✓ Проем door_1 (horizontal): 2 сегментов
  ✓ Проем door_3 (horizontal): 2 сегментов
  ✓ Проем window_3 (vertical): 2 сегментов
  ✓ Проем window_5 (vertical): 2 сегментов
  ✓ Проем window_6 (vertical): 2 сегментов
  ✓ Проем window_7 (vertical): 2 сегментов
  ✓ Проем window_1 (horizontal): 2 сегментов
  ✓ Проем door_4 (vertical): 2 сегментов
  ✓ Проем door_5 (horizontal): 2 сегментов
  ✓ Проем door_6 (vertical): 2 сегментов

Всего создано 26 сегментов стен из 13 проемов
✓ Создано 26 сегментов стен из проемов
  ✓ Загружено 45 junctions
Анализ типов 45 junctions с улучшенной логикой...
  Junction 1 (780.0, 618.0): тип=unknown (не внутри полигона)
  Junction 2 (614.0, 799.0): тип=L, направления=left, up
  Junction 3 (1081.0, 1092.0): тип=L, направления=left, up
  Junction 4 (2032.0, 1432.0): тип=unknown (не внутри полигона)
  Junction 5 (215.0, 975.0): тип=L, направления=right, up
  Junction 6 (787.0, 1092.0): тип=L, направления=right, up
  Junction 7 (215.0, 151.0): тип=L, направления=right, down
  Junction 8 (2033.0, 16.0): тип=unknown (не внутри полигона)
  Junction 9 (1081.0, 150.0): тип=L, направления=left, down
  Junction 10 (615.0, 617.0): тип=L, направления=left, down
  Junction 11 (414.0, 618.0): тип=T, направления=left, right, down
  Junction 12 (787.0, 977.0): тип=L, направления=left, down
  Junction 13 (417.0, 975.0): тип=T, направления=left, right, up
  Junction 14 (215.0, 616.0): тип=L, направления=right, up
  Junction 15 (415.0, 800.0): тип=T, направления=right, up, down
  Junction 16 (287.0, 150.0): тип=unknown, направления=left
  Junction 17 (718.0, 150.0): тип=unknown (не внутри полигона)
  Junction 18 (623.0, 151.0): тип=unknown (не внутри полигона)
  Junction 19 (280.0, 616.0): тип=unknown (не внутри полигона)
  Junction 20 (278.0, 978.0): тип=unknown (не внутри полигона)
  Junction 21 (623.0, 978.0): тип=unknown (не внутри полигона)
  Junction 22 (821.0, 1090.0): тип=unknown, направления=left
  Junction 23 (716.0, 150.0): тип=unknown (не внутри полигона)
  Junction 24 (806.0, 150.0): тип=unknown, направления=right
  Junction 25 (442.0, 151.0): тип=unknown, направления=right
  Junction 26 (348.0, 617.0): тип=unknown (не внутри полигона)
  Junction 27 (368.0, 976.0): тип=unknown (не внутри полигона)
  Junction 28 (754.0, 976.0): тип=unknown (не внутри полигона)
  Junction 29 (1046.0, 1091.0): тип=unknown, направления=right
  Junction 30 (216.0, 220.0): тип=unknown, направления=up
  Junction 31 (1081.0, 525.0): тип=unknown (не внутри полигона)
  Junction 32 (1081.0, 633.0): тип=unknown (не внутри полигона)
  Junction 33 (615.0, 657.0): тип=unknown, направления=up
  Junction 34 (216.0, 677.0): тип=unknown (не внутри полигона)
  Junction 35 (786.0, 812.0): тип=unknown (не внутри полигона)
  Junction 36 (216.0, 375.0): тип=unknown, направления=down
  Junction 37 (1080.0, 588.0): тип=unknown (не внутри полигона)
  Junction 38 (1080.0, 696.0): тип=unknown (не внутри полигона)
  Junction 39 (616.0, 727.0): тип=unknown (не внутри полигона)
  Junction 40 (216.0, 738.0): тип=unknown (не внутри полигона)
  Junction 41 (786.0, 903.0): тип=unknown, направления=down
  Junction 42 (2014.0, 1276.0): тип=unknown (не внутри полигона)
  Junction 43 (2016.0, 1280.0): тип=unknown (не внутри полигона)
  Junction 44 (2020.0, 1280.0): тип=unknown (не внутри полигона)
  Junction 45 (2017.0, 1347.0): тип=unknown (не внутри полигона)

Статистика типов junctions:
  unknown: 33
  L: 9
  T: 3
✓ Найдено 9 L-junctions

--- Детальный анализ L-junction 10 ---
Координаты: (615.0, 617.0)
Направления: ['left', 'down']
Тип: L
Связанные сегменты: 1
  Сегмент 1: wall_door_6_top_33_to_10, ориентация: vertical
    bbox: {'x': 603.5, 'y': 617.0, 'width': 22.0, 'height': 40.0, 'orientation': 'vertical'}

--- Тестирование расширений ---
  ✓ Найдено 9 L-junctions
  Обработка L-junction 2 (614.0, 799.0)
    ✗ Недостаточно сегментов для L-junction 2
  Обработка L-junction 3 (1081.0, 1092.0)
    ✓ Выбран сегмент для расширения: wall_window_7_bottom_38_to_3
    ✓ Оригинальные границы segment bbox: {'x': 1069.0, 'y': 695.0, 'width': 22.0, 'height': 397.0, 'orientation': 'vertical'}
    → Шаг 1: Расширение до границы полигона...
    ✓ Выбран перпендикулярный сегмент: wall_window_1_right_29_to_3
    → Шаг 2: Расширение до перпендикулярного сегмента...
    ✓ Сегмент wall_window_7_bottom_38_to_3 расширен вниз до 1103.0
    ✓ После расширения до перпендикуляра: {'x': 1069.0, 'y': 695.0, 'width': 22.0, 'height': 408.0, 'orientation': 'vertical'}
    ✓ Итог: Сегмент wall_window_7_bottom_38_to_3 расширен
      оригинал: {'x': 1069.0, 'y': 695.0, 'width': 22.0, 'height': 397.0, 'orientation': 'vertical'}
      результат: {'x': 1069.0, 'y': 695.0, 'width': 22.0, 'height': 408.0, 'orientation': 'vertical'}
  Обработка L-junction 5 (215.0, 975.0)
    ✓ Выбран сегмент для расширения: wall_door_3_left_20_to_5
    ✓ Оригинальные границы segment bbox: {'x': 215.0, 'y': 966.5, 'width': 62.0, 'height': 22.0, 'orientation': 'horizontal'}
    → Шаг 1: Расширение до границы полигона...
    ✓ Сегмент wall_door_3_left_20_to_5 расширен вправо до 279.0
    ✓ После расширения до границы полигона: {'x': 215.0, 'y': 966.5, 'width': 64.0, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Выбран перпендикулярный сегмент: wall_window_5_bottom_40_to_5
    → Шаг 2: Расширение до перпендикулярного сегмента...
    ✓ Сегмент wall_door_3_left_20_to_5 расширен влево до 204.5
    ✓ После расширения до перпендикуляра: {'x': 204.5, 'y': 966.5, 'width': 74.5, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Итог: Сегмент wall_door_3_left_20_to_5 расширен
      оригинал: {'x': 215.0, 'y': 966.5, 'width': 62.0, 'height': 22.0, 'orientation': 'horizontal'}
      результат: {'x': 204.5, 'y': 966.5, 'width': 74.5, 'height': 22.0, 'orientation': 'horizontal'}
  Обработка L-junction 6 (787.0, 1092.0)
    ✗ Недостаточно сегментов для L-junction 6
  Обработка L-junction 7 (215.0, 151.0)
    ✓ Выбран сегмент для расширения: wall_window_2_left_16_to_7
    ✓ Оригинальные границы segment bbox: {'x': 215.0, 'y': 139.0, 'width': 71.0, 'height': 22.0, 'orientation': 'horizontal'}
    → Шаг 1: Расширение до границы полигона...
    ✓ Сегмент wall_window_2_left_16_to_7 расширен вправо до 287.3333333333333
    ✓ После расширения до границы полигона: {'x': 215.0, 'y': 139.0, 'width': 72.33333333333331, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Выбран перпендикулярный сегмент: wall_window_3_top_30_to_7
    → Шаг 2: Расширение до перпендикулярного сегмента...
    ✓ Сегмент wall_window_2_left_16_to_7 расширен влево до 204.5
    ✓ После расширения до перпендикуляра: {'x': 204.5, 'y': 139.0, 'width': 82.83333333333331, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Итог: Сегмент wall_window_2_left_16_to_7 расширен
      оригинал: {'x': 215.0, 'y': 139.0, 'width': 71.0, 'height': 22.0, 'orientation': 'horizontal'}
      результат: {'x': 204.5, 'y': 139.0, 'width': 82.83333333333331, 'height': 22.0, 'orientation': 'horizontal'}
  Обработка L-junction 9 (1081.0, 150.0)
    ✓ Выбран сегмент для расширения: wall_door_2_right_24_to_9
    ✓ Оригинальные границы segment bbox: {'x': 807.0, 'y': 139.0, 'width': 274.0, 'height': 22.0, 'orientation': 'horizontal'}
    → Шаг 1: Расширение до границы полигона...
    ✓ Сегмент wall_door_2_right_24_to_9 расширен влево до 805.0
    ✓ После расширения до границы полигона: {'x': 805.0, 'y': 139.0, 'width': 276.0, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Выбран перпендикулярный сегмент: wall_window_6_top_31_to_9
    → Шаг 2: Расширение до перпендикулярного сегмента...
    ✓ Сегмент wall_door_2_right_24_to_9 расширен вправо до 1091.0
    ✓ После расширения до перпендикуляра: {'x': 805.0, 'y': 139.0, 'width': 286.0, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Итог: Сегмент wall_door_2_right_24_to_9 расширен
      оригинал: {'x': 807.0, 'y': 139.0, 'width': 274.0, 'height': 22.0, 'orientation': 'horizontal'}
      результат: {'x': 805.0, 'y': 139.0, 'width': 286.0, 'height': 22.0, 'orientation': 'horizontal'}
  Обработка L-junction 10 (615.0, 617.0)
    ✗ Недостаточно сегментов для L-junction 10
  Обработка L-junction 12 (787.0, 977.0)
    ✓ Выбран сегмент для расширения: wall_door_1_right_28_to_12
    ✓ Оригинальные границы segment bbox: {'x': 755.0, 'y': 966.5, 'width': 32.0, 'height': 22.0, 'orientation': 'horizontal'}
    → Шаг 1: Расширение до границы полигона...
    ✓ Сегмент wall_door_1_right_28_to_12 расширен влево до 756.0
    ✓ После расширения до границы полигона: {'x': 756.0, 'y': 966.5, 'width': 31.0, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Выбран перпендикулярный сегмент: wall_door_4_bottom_41_to_12
    → Шаг 2: Расширение до перпендикулярного сегмента...
    ✓ Сегмент wall_door_1_right_28_to_12 расширен вправо до 796.5
    ✓ После расширения до перпендикуляра: {'x': 756.0, 'y': 966.5, 'width': 40.5, 'height': 22.0, 'orientation': 'horizontal'}
    ✓ Итог: Сегмент wall_door_1_right_28_to_12 расширен
      оригинал: {'x': 755.0, 'y': 966.5, 'width': 32.0, 'height': 22.0, 'orientation': 'horizontal'}
      результат: {'x': 756.0, 'y': 966.5, 'width': 40.5, 'height': 22.0, 'orientation': 'horizontal'}
  Обработка L-junction 14 (215.0, 616.0)
    ✓ Выбран сегмент для расширения: wall_window_3_bottom_36_to_14
    ✓ Оригинальные границы segment bbox: {'x': 204.5, 'y': 375.0, 'width': 22.0, 'height': 241.0, 'orientation': 'vertical'}
    → Шаг 1: Расширение до границы полигона...
    ✓ Выбран перпендикулярный сегмент: wall_window_5_top_34_to_14
    → Шаг 2: Расширение до перпендикулярного сегмента...
    ✗ Сегмент wall_window_3_bottom_36_to_14 не был расширен
  ✓ Расширено 9 сегментов для L-junctions
✓ Расширено 9 сегментов

--- Проверка сегментов после расширения ---
Связанные сегменты после расширения: 1
  Сегмент 1: wall_door_6_top_33_to_10, ориентация: vertical
    bbox после расширения: {'x': 603.5, 'y': 617.0, 'width': 22.0, 'height': 40.0, 'orientation': 'vertical'}

============================================================
ТЕСТИРОВАНИЕ ЗАВЕРШЕНО
============================================================
