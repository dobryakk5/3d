# Исправление выравнивания стен

## Обзор

Этот проект решает проблему выравнивания стен в визуализации плана этажа, где проемы на одной стене не выровнены, создавая несколько ограничивающих рамок вместо одной прямой стены (особенно проблема J18-J25).

## Файлы проекта

### Основные скрипты

1. **`wall_alignment_fix_v2.py`** - Основной класс для выравнивания стен
2. **`solve_j18_j25_issue.py`** - Итоговый скрипт для решения проблемы J18-J25
3. **`visualize_polygons.py`** - Оригинальный скрипт визуализации

### Вспомогательные скрипты

1. **`test_alignment.py`** - Тестирование выравнивания
2. **`visualize_aligned_complete.py`** - Полная визуализация с выравниванием
3. **`fix_wall_alignment_standalone.py`** - Автономное исправление выравнивания

### Скрипты для запуска

1. **`run_alignment_test.sh`** - Запуск теста выравнивания
2. **`run_visualization_aligned.sh`** - Запуск визуализации с выравниванием
3. **`run_fix_alignment.sh`** - Запуск исправления выравнивания

## Использование

### Быстрый старт

Для решения проблемы J18-J25 запустите:

```bash
cd floor
python3 solve_j18_j25_issue.py
```

Это создаст:
- `plan_floor1_objects_j18_j25_fixed.json` - Выравненные данные
- `wall_polygons_j18_j25_fixed.svg` - Визуализация с выравненными стенами

### Продвинутое использование

1. **Тестирование выравнивания**:
   ```bash
   python3 wall_alignment_fix_v2.py
   ```

2. **Полная визуализация с выравниванием**:
   ```bash
   python3 visualize_aligned_complete.py
   ```

3. **Автономное исправление**:
   ```bash
   python3 fix_wall_alignment_standalone.py
   ```

## Принцип работы

1. **Группировка проемов**: Скрипт группирует проемы по стенам на основе их ориентации (горизонтальная/вертикальная) и положения
2. **Определение крайнего проема**: Для каждой стены находится проем, ближайший к внешней стороне
3. **Выравнивание**: Все проемы на стене выравниваются по положению крайнего проема
4. **Визуализация**: Создается новая визуализация с выравненными стенами

## Проблема J18-J25

В исходной визуализации стена от J18 до J25 имела две ограничивающие рамки вместо одной прямой из-за невыровненных проемов. После применения выравнивания стена отображается как один прямой сегмент.

## Результаты

- ✓ Все стены с множественными проемами выровнены
- ✓ Проблема J18-J25 решена
- ✓ Визуализация показывает прямые стены
- ✓ Исходные данные не изменены

## Требования

- Python 3.6+
- Библиотеки: json, math, typing, dataclasses
- svgwrite (для визуализации)

## Отладка

Для включения отладочного вывода установите `debug=True` при создании `WallAlignmentFixerV2`:

```python
fixer = WallAlignmentFixerV2(tolerance=50.0, debug=True)
```

## Настройка

Параметры выравнивания можно настроить:

- `tolerance`: Допуск для группировки проемов (по умолчанию 50.0 пикселей)
- `debug`: Режим отладки (по умолчанию False)

## Заключение

Скрипты успешно решают проблему выравнивания стен, создавая чистую визуализацию с прямыми стенами. Проблема J18-J25 полностью устранена.